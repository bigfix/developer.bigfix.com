#!/bin/bash

set -e
set -x

# Update all the things
apt-get update

# Add node ppa
curl -sL https://deb.nodesource.com/setup | bash -

# Install all the things
apt-get install -y git nginx nodejs

# Setup nginx
mkdir -p /var/www/site

rm -rf /etc/nginx/sites-enabled/*
rm -rf /etc/nginx/sites-available/*

cp /vagrant/conf/nginx/dev.conf /etc/nginx/sites-available
cp /vagrant/conf/nginx/prod.conf /etc/nginx/sites-available
cp /vagrant/conf/nginx/shared.conf /etc/nginx

ln -s /etc/nginx/sites-available/dev.conf /etc/nginx/sites-enabled/

nginx -s reload

# Add message for how to build the site
echo 'It works!' > /var/www/site/index.html

# Change ownership to vagrant
chown -R vagrant:vagrant /var/www/site
